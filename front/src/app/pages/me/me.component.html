<main class="profile-container">
  <header class="header-actions">
    <h1>Profil utilisateur</h1>
  </header>

  @if (user$ | async; as user) {

  <form
    [formGroup]="form"
    (ngSubmit)="submit()"
    class="profile-card"
    aria-label="Modifier mes informations personnelles"
  >
    <div class="info-group">
      <label for="profile-name">Nom d'utilisateur</label>
      <input
        id="profile-name"
        type="text"
        formControlName="name"
        aria-required="true"
        [attr.aria-invalid]="
          form.get('name')?.invalid && form.get('name')?.touched
        "
      />
    </div>

    <div class="info-group">
      <label for="profile-email">Adresse e-mail</label>
      <input
        id="profile-email"
        type="email"
        formControlName="email"
        aria-required="true"
        [attr.aria-invalid]="
          form.get('email')?.invalid && form.get('email')?.touched
        "
      />
    </div>

    <div class="info-group">
      <label for="profile-password">Nouveau mot de passe (optionnel)</label>
      <input
        id="profile-password"
        type="password"
        formControlName="password"
        placeholder="••••••••"
      />
    </div>

    <button
      type="submit"
      class="btn-save"
      [disabled]="form.invalid || form.pristine"
      aria-label="Enregistrer les modifications du profil"
    >
      Sauvegarder
    </button>
  </form>

  <section class="subscriptions-section" aria-labelledby="subs-title">
    <h2 id="subs-title">Abonnements</h2>
    <div class="subscriptions-grid" role="list">
      @for (sub of user.subscriptions; track sub.id) {
      <app-theme-card
        [id]="sub.id"
        [title]="sub.title"
        [description]="sub.description"
      >
        <button
          action-button
          class="btn-primary"
          (click)="unsubscribe(sub.id)"
          [attr.aria-label]="'Se désabonner du thème ' + sub.title"
        >
          Se désabonner
        </button>
      </app-theme-card>
      } @empty {
      <p class="no-subs" role="status">Vous n'êtes abonné à aucun thème.</p>
      }
    </div>
  </section>

  } @else {
  <div class="loading" role="status" aria-live="polite">
    <p>Chargement de vos informations...</p>
  </div>
  }
</main>
